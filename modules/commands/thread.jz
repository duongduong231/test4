module.exports.config = {
	name: "thread",
	version: "0.0.1",
	hasPermssion: 2,
	credits: "CatalizCS",
	description: "C·∫•m ho·∫∑c g·ª° c·∫•m nh√≥m",
	commandCategory: "system",
	usages: "thread args input",
	cooldowns: 5,
	info: [
		{
			key: 'args => ban',
			prompt: 'Nh·∫≠p input l√† ID thread c·∫ßn ban',
			type: 'Number',
			example: '100000'
		},
		{
			key: 'args => unban',
			prompt: 'Nh·∫≠p input l√† ID thread c·∫ßn unban',
			type: 'Number',
			example: '100000'
		},
		{
			key: 'args => search',
			prompt: 'Nh·∫≠p input l√† t·ª´ kho√° c·∫ßn t√¨m thread',
			type: 'String',
			example: 'khu'
		}
	]
};

module.exports.handleReaction = async ({ event, api, Threads, client, handleReaction }) => {
	if (parseInt(event.userID) !== parseInt(handleReaction.author)) return;
	switch (handleReaction.type) {
		case "ban": {
			await Threads.setData(handleReaction.target, { banned: 1 });
			let dataThread = client.threadBanned.get(handleReaction.target.toString()) || {};
			dataThread["banned"] = 1;
			client.threadBanned.set(handleReaction.target, dataThread);
			api.sendMessage(`[${handleReaction.target}] ƒê√£ ban th√†nh c√¥ng!`, event.threadID, () => api.unsendMessage(handleReaction.messageID));
			break;
		}
		case "unban": {
			await Threads.setData(handleReaction.target, { banned: 0 });
			client.threadBanned.delete(handleReaction.target.toString());
			api.sendMessage(`[${handleReaction.target}] ƒê√£ unban th√†nh c√¥ng!`, event.threadID, () => api.unsendMessage(handleReaction.messageID));
			break;
		}
		default:
			break;
	}
}

module.exports.run = async ({ event, api, args, Threads, client }) => {
    let content = args.slice(1, args.length);
	switch (args[0]) {
		case "ban": {
			if (content.length == 0) return api.sendMessage("B·∫°n c·∫ßn ph·∫£i nh·∫≠p ID thread c·∫ßn ban!", event.threadID);
			for (let idThread of content) {
				idThread = parseInt(idThread);
				if (isNaN(idThread)) return api.sendMessage(`[${idThread}] kh√¥ng ph·∫£i l√† IDthread!`, event.threadID);
				let dataThread = (await Threads.getData(idThread.toString()));
				if (!dataThread) return api.sendMessage(`[${idThread}] thread kh√¥ng t·ªìn t·∫°i trong database!`, event.threadID);
				if (dataThread.banned) return api.sendMessage(`[${idThread}] ƒê√£ b·ªã ban t·ª´ tr∆∞·ªõc`, event.threadID);
				return api.sendMessage(`[${idThread}] B·∫°n mu·ªën ban thread n√†y ?\n\nH√£y reaction v√†o tin nh·∫Øn n√†y ƒë·ªÉ ban!`, event.threadID, (error, info) => {
					client.handleReaction.push({
						name: this.config.name,
						messageID: info.messageID,
						author: event.senderID,
						type: "ban",
						target: idThread
					});
				})
			}
			break;
		}
		case "unban": {
			if (content.length == 0) return api.sendMessage("B·∫°n c·∫ßn ph·∫£i nh·∫≠p ID thread c·∫ßn ban!", event.threadID);
			for (let idThread of content) {
				idThread = parseInt(idThread);
				if (isNaN(idThread)) return api.sendMessage(`[${idThread}] kh√¥ng ph·∫£i l√† IDthread!`, event.threadID);
				let dataThread = (await Threads.getData(idThread.toString()));
				if (!dataThread) return api.sendMessage(`[${idThread}] thread kh√¥ng t·ªìn t·∫°i trong database!`, event.threadID);
				if (!dataThread.banned) return api.sendMessage(`[${idThread}] Kh√¥ng b·ªã ban t·ª´ tr∆∞·ªõc`, event.threadID);
				return api.sendMessage(`[${idThread}] B·∫°n mu·ªën unban thread n√†y ?\n\nH√£y reaction v√†o tin nh·∫Øn n√†y ƒë·ªÉ ban!`, event.threadID, (error, info) => {
					client.handleReaction.push({
						name: this.config.name,
						messageID: info.messageID,
						author: event.senderID,
						type: "unban",
						target: idThread
					});
				})
			}
			break;
		}
    case "banList": {
      var data = await Threads.getAll(['name', 'threadID'], {banned: true});
      var threadBlockMsg = "";
      data.forEach(thread => threadBlockMsg += `\n${thread.name} - ${thread.threadID}`);
      return api.sendMessage((threadBlockMsg) ? `üõ† | ƒê√¢y l√† danh s√°ch c√°c nh√≥m b·ªã ban:${threadBlockMsg}` : 'Ch∆∞a c√≥ nh√≥m n√†o b·ªã b·∫°n c·∫•m!', event.threadID, event.messageID);
    break;
    }
		case "search": {
			let contentJoin = content.join(" ");
			let getThreads =  (await Threads.getAll(['threadID', 'name'])).filter(item => !!item.name);
			let matchThreads = [], a = '', b = 0;
			getThreads.forEach(i => {
				if (i.name.toLowerCase().includes(contentJoin.toLowerCase())) {
					matchThreads.push({
						name: i.name,
						id: i.threadID
					});
				}
			});
			matchThreads.forEach(i => a += `\n${b += 1}. ${i.name} - ${i.id}`);
			(matchThreads.length > 0) ? api.sendMessage(`ƒê√¢y l√† k·∫øt qu·∫£ ph√π h·ª£p: \n${a}`, event.threadID) : api.sendMessage("Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ d·ª±a v√†o t√¨m ki·∫øm c·ªßa b·∫°n!", event.threadID);
			break;
		}
		default:
			break;
  }
}
	
      e("Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ d·ª±a v√†o t√¨m ki·∫øm c·ªßa b·∫°n!", event.threadID);
			break;
		}
		default:
			break;
	}
}